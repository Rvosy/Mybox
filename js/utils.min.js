(()=>{const btfFn={debounce:(func,wait=0,immediate=!1)=>{let timeout;return(...args)=>{const later=()=>{timeout=null,immediate||func(...args)},callNow=immediate&&!timeout;clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func(...args)}},throttle:function(func,wait,options={}){let timeout,context,args,previous=0;const later=()=>{previous=!1===options.leading?0:(new Date).getTime(),timeout=null,func.apply(context,args),timeout||(context=args=null)},throttled=(...params)=>{const now=(new Date).getTime();previous||!1!==options.leading||(previous=now);const remaining=wait-(now-previous);context=this,args=params,remaining<=0||remaining>wait?(timeout&&(clearTimeout(timeout),timeout=null),previous=now,func.apply(context,args),timeout||(context=args=null)):timeout||!1===options.trailing||(timeout=setTimeout(later,remaining))};return throttled},overflowPaddingR:{add:()=>{const paddingRight=window.innerWidth-document.body.clientWidth;if(paddingRight>0){document.body.style.paddingRight=`${paddingRight}px`,document.body.style.overflow="hidden";const menuElement=document.querySelector("#page-header.nav-fixed #menus");menuElement&&(menuElement.style.paddingRight=`${paddingRight}px`)}},remove:()=>{document.body.style.paddingRight="",document.body.style.overflow="";const menuElement=document.querySelector("#page-header.nav-fixed #menus");menuElement&&(menuElement.style.paddingRight="")}},snackbarShow:(text,showAction=!1,duration=2e3)=>{const{position:position,bgLight:bgLight,bgDark:bgDark}=GLOBAL_CONFIG.Snackbar,bg="light"===document.documentElement.getAttribute("data-theme")?bgLight:bgDark;Snackbar.show({text:text,backgroundColor:bg,showAction:showAction,duration:duration,pos:position,customClass:"snackbar-css"})},diffDate:(inputDate,more=!1)=>{const dateNow=new Date,datePost=new Date(inputDate),diffMs=dateNow-datePost,diffSec=diffMs/1e3,diffMin=diffSec/60,diffHour=diffMin/60,diffDay=diffHour/24,diffMonth=diffDay/30,{dateSuffix:dateSuffix}=GLOBAL_CONFIG;return more?diffMonth>12?datePost.toISOString().slice(0,10):diffMonth>=1?`${Math.floor(diffMonth)} ${dateSuffix.month}`:diffDay>=1?`${Math.floor(diffDay)} ${dateSuffix.day}`:diffHour>=1?`${Math.floor(diffHour)} ${dateSuffix.hour}`:diffMin>=1?`${Math.floor(diffMin)} ${dateSuffix.min}`:dateSuffix.just:Math.floor(diffDay)},loadComment:(dom,callback)=>{if("IntersectionObserver"in window){const observerItem=new IntersectionObserver(entries=>{entries[0].isIntersecting&&(callback(),observerItem.disconnect())},{threshold:[0]});observerItem.observe(dom)}else callback()},scrollToDest:(pos,time=500)=>{const currentPos=window.scrollY,isNavFixed=document.getElementById("page-header").classList.contains("fixed");if((currentPos>pos||isNavFixed)&&(pos-=70),"scrollBehavior"in document.documentElement.style)return void window.scrollTo({top:pos,behavior:"smooth"});const startTime=performance.now(),animate=currentTime=>{const timeElapsed=currentTime-startTime,progress=Math.min(timeElapsed/time,1);window.scrollTo(0,currentPos+(pos-currentPos)*progress),progress<1&&requestAnimationFrame(animate)};requestAnimationFrame(animate)},animateIn:(ele,animation)=>{ele.style.display="block",ele.style.animation=animation},animateOut:(ele,animation)=>{const handleAnimationEnd=()=>{ele.style.display="",ele.style.animation="",ele.removeEventListener("animationend",handleAnimationEnd)};ele.addEventListener("animationend",handleAnimationEnd),ele.style.animation=animation},wrap:(selector,eleType,options)=>{const createEle=document.createElement(eleType);for(const[key,value]of Object.entries(options))createEle.setAttribute(key,value);selector.parentNode.insertBefore(createEle,selector),createEle.appendChild(selector)},isHidden:ele=>0===ele.offsetHeight&&0===ele.offsetWidth,getEleTop:ele=>{let actualTop=ele.offsetTop,current=ele.offsetParent;for(;null!==current;)actualTop+=current.offsetTop,current=current.offsetParent;return actualTop},loadLightbox:ele=>{const service=GLOBAL_CONFIG.lightbox;"medium_zoom"===service&&mediumZoom(ele,{background:"var(--zoom-bg)"}),"fancybox"===service&&(Array.from(ele).forEach(i=>{if("A"!==i.parentNode.tagName){const dataSrc=i.dataset.lazySrc||i.src,dataCaption=i.title||i.alt||"";btf.wrap(i,"a",{href:dataSrc,"data-fancybox":"gallery","data-caption":dataCaption,"data-thumb":dataSrc})}}),window.fancyboxRun||(Fancybox.bind("[data-fancybox]",{Hash:!1,Thumbs:{showOnStart:!1},Images:{Panzoom:{maxScale:4}},Carousel:{transition:"slide"},Toolbar:{display:{left:["infobar"],middle:["zoomIn","zoomOut","toggle1to1","rotateCCW","rotateCW","flipX","flipY"],right:["slideshow","thumbs","close"]}}}),window.fancyboxRun=!0))},setLoading:{add:ele=>{const html='\n        <div class="loading-container">\n          <div class="loading-item">\n            <div></div><div></div><div></div><div></div><div></div>\n          </div>\n        </div>\n      ';ele.insertAdjacentHTML("afterend",html)},remove:ele=>{ele.nextElementSibling.remove()}},updateAnchor:anchor=>{if(anchor!==window.location.hash){anchor||(anchor=location.pathname);const title=GLOBAL_CONFIG_SITE.title;window.history.replaceState({url:location.href,title:title},title,anchor)}},getScrollPercent:(()=>{let docHeight,winHeight,headerHeight,contentMath;return(currentTop,ele)=>{docHeight&&ele.clientHeight===docHeight||(docHeight=ele.clientHeight,winHeight=window.innerHeight,headerHeight=ele.offsetTop,contentMath=Math.max(docHeight-winHeight,document.documentElement.scrollHeight-winHeight));const scrollPercent=(currentTop-headerHeight)/contentMath;return Math.max(0,Math.min(100,Math.round(100*scrollPercent)))}})(),addEventListenerPjax:(ele,event,fn,option=!1)=>{ele.addEventListener(event,fn,option),btf.addGlobalFn("pjaxSendOnce",()=>{ele.removeEventListener(event,fn,option)})},removeGlobalFnEvent:(key,parent=window)=>{const globalFn=parent.globalFn||{},keyObj=globalFn[key];keyObj&&(Object.keys(keyObj).forEach(i=>keyObj[i]()),delete globalFn[key])}};window.btf={...window.btf,...btfFn}})();